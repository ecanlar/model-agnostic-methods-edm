---
title: "Bidimensional Partial Dependency Plot"
author: "Yusef Ahsini Ouariaghli, Eva Cantín Larumbe and Pablo Díaz-Masa Valencia"
date: "2023-04-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#clean and prepare the data
df <- read.csv("day.csv")
df$season <- as.factor(df$season)
df$MISTY <- ifelse(df$weathersit == 2, 1, 0)
df$RAIN <- ifelse(df$weathersit %in% c(3, 4), 1, 0)
df$temp <- df$temp * 47 - 8
df$hum <- df$hum * 100
df$windspeed <- df$windspeed * 67
df$dteday <- as.Date(df$dteday, format = "%Y-%m-%d")
df$days_since_2011 <- as.numeric(df$dteday - as.Date("2011-01-01"))
```

```{r}
#random forest model
library(randomForest)
set.seed(1234)
rf <- randomForest(formula = cnt ~ workingday +  holiday + season + MISTY + RAIN + temp + hum + windspeed + days_since_2011,                    data = df)
```

**Generate a 2D Partial Dependency Plot with humidity and temperature to predict the number of bikes rented depending on those parameters.**

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(pdp)
p5 <- partial(rf, pred.var = c("temp", "hum"), plot=TRUE, rug=TRUE, train=df)
p5
```

The generated graphic relates humidity and temperature to the predicted amount of bikes rented.

The first thing that catches our attention is the large yellowish zone on the right side of the figure, indicating the ideal temperature range where people rent bikes. However, when we look at the area above this yellow zone, we realize a sharp drop in the number of rented bikes when humidity exceeds approximately 70%. This vertical parallelism is maintained throughout the entire graph. That is, humidity only causes users to stop renting bikes once it exceeds the threshold of 70%. Regarding the other variable, low temperatures persuade people to rent bikes. This effect is also observed at high temperatures, although to a much lesser extent.

Naturally, when the temperature is very low, and humidity is very high, the number of rented bikes reaches its minimum. However, the rugs in both variables indicate few cases in the database.
The approximate ranges of temperature and humidity that maximize the number of rented bikes are 20-23 ºC and 40-50 %, respectively.

